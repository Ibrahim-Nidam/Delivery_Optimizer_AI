paths:
  /api/tours:
    get:
      tags: [Tours]
      summary: Get all tours
      description: Returns a list of all tours in the system.
      responses:
        '200':
          description: List of tours
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TourDTO'

    post:
      tags: [Tours]
      summary: Create a new tour
      description: Creates a new tour with vehicle, warehouse, and deliveries.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TourDTO'
            example:
              vehicleId: 1
              warehouseId: 1
              deliveryIds: [1, 2, 3]
              date: "2025-11-07"
              totalDistance: 120.5
              status: "PLANNED"
      responses:
        '201':
          description: Tour created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TourDTO'

  /api/tours/{id}:
    get:
      tags: [Tours]
      summary: Get tour by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tour retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TourDTO'
        '404':
          description: Tour not found

    put:
      tags: [Tours]
      summary: Update an existing tour
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TourDTO'
      responses:
        '200':
          description: Tour updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TourDTO'
        '404':
          description: Tour not found

    delete:
      tags: [Tours]
      summary: Delete a tour
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Tour deleted successfully
        '404':
          description: Tour not found

  /api/tours/{id}/deliveries:
    post:
      tags: [Tours]
      summary: Add deliveries to an existing tour
      description: >
        Adds deliveries to a tour while validating vehicle capacity and ensuring no delivery is already assigned.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: integer
              example: [4, 5, 6]
      responses:
        '200':
          description: Deliveries successfully added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TourDTO'
        '400':
          description: Invalid delivery list or vehicle constraints exceeded
        '404':
          description: Tour or deliveries not found

  /api/tours/{id}/optimize:
    get:
      tags: [Tours]
      summary: Optimize tour using configured optimizer
      description: |
        Optimizes the delivery order using the optimizer defined in the application configuration (`application.yml`).

        The optimizer type can be one of:
        - `NN`: Nearest Neighbor algorithm  
        - `CW`: Clarke & Wright algorithm  
        - `AI`: AI-powered optimization using Spring AI and LLM integration

        This single endpoint replaces separate algorithm-specific ones.  
        Example configuration in `application.yml`:
        ```yaml
        optimizer:
          type: NN # or CW, AI
        ```

        Returns the list of delivery IDs in optimized order.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Tour optimized successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: integer
                example: [3, 1, 2, 4]
        '400':
          description: Tour has no deliveries to optimize or invalid optimizer configuration
        '404':
          description: Tour not found

  /api/tours/{id}/distances:
    get:
      tags: [Tours]
      summary: Compare total distances for all available optimizers
      description: >
        Computes and compares total tour distances using all available optimizers (`NN`, `CW`, `AI`).
        Useful for benchmarking and validating optimization performance.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Distances calculated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  Nearest Neighbor:
                    type: string
                    example: "8.3 km"
                  Clarke Wright:
                    type: string
                    example: "8.5 km"
                  AI Optimizer:
                    type: string
                    example: "7.8 km"
        '404':
          description: Tour not found

components:
  schemas:
    TourDTO:
      type: object
      properties:
        id:
          type: integer
          example: 1
        vehicleId:
          type: integer
          example: 1
        deliveryIds:
          type: array
          items:
            type: integer
          example: [1, 2, 3]
        warehouseId:
          type: integer
          example: 1
        date:
          type: string
          format: date
          example: "2025-10-24"
        totalDistance:
          type: number
          format: double
          example: 120.5
        status:
          type: string
          enum: ["PLANNED", "IN_PROGRESS", "COMPLETED"]
          example: "PLANNED"
      required:
        - vehicleId
        - warehouseId
        - date
        - totalDistance
        - status

    OptimizationResultDTO:
      type: object
      description: Detailed result of tour optimization showing step-by-step route calculation
      properties:
        tourId:
          type: integer
          description: ID of the optimized tour
          example: 1
        algorithm:
          type: string
          description: Name of the optimization algorithm used
          example: "Nearest Neighbor"
        optimizedDeliveryIds:
          type: array
          description: List of delivery IDs in optimized order
          items:
            type: integer
          example: [3, 1, 2, 4]
        totalDistance:
          type: number
          format: double
          description: Total distance of the optimized tour in kilometers
          example: 46.0
        steps:
          type: array
          description: Step-by-step breakdown of the route with distances
          items:
            $ref: '#/components/schemas/RouteStepDTO'
        warehouseLocation:
          $ref: '#/components/schemas/LocationDTO'
        deliveries:
          type: array
          description: List of deliveries in optimized order with location details
          items:
            $ref: '#/components/schemas/DeliveryLocationDTO'

    RouteStepDTO:
      type: object
      description: A single step in the optimized route
      properties:
        stepNumber:
          type: integer
          description: Sequential step number
          example: 1
        from:
          type: string
          description: Starting point name
          example: "Warehouse (Main)"
        to:
          type: string
          description: Destination point name
          example: "Delivery A"
        fromId:
          type: integer
          nullable: true
          description: ID of the starting delivery (null if warehouse)
          example: null
        toId:
          type: integer
          nullable: true
          description: ID of the destination delivery (null if warehouse)
          example: 3
        distance:
          type: number
          format: double
          description: Distance for this step in kilometers
          example: 5.0
        cumulativeDistance:
          type: number
          format: double
          description: Total distance accumulated up to this step
          example: 5.0

    LocationDTO:
      type: object
      description: Geographic location information
      properties:
        name:
          type: string
          example: "Main Warehouse"
        latitude:
          type: number
          format: double
          example: 33.5731
        longitude:
          type: number
          format: double
          example: -7.5898

    DeliveryLocationDTO:
      type: object
      description: Delivery point with location details
      properties:
        id:
          type: integer
          example: 3
        customerName:
          type: string
          example: "Client A"
        address:
          type: string
          example: "123 Rue A, Casablanca"
        latitude:
          type: number
          format: double
          example: 33.5800
        longitude:
          type: number
          format: double
          example: -7.5850